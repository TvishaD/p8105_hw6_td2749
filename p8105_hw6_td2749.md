p8105_hw6_td2749
================
Tvisha R. Devavarapu
2022-11-22

``` r
library(tidyverse)
library(ggplot2)
library(modelr)
library(mgcv)

knitr::opts_chunk$set(
  fig.width = 10,
  fig.asp = .6,
  out.width = "90%")
```

# Problem 2

``` r
homicide_data = 
  read_csv("./data/homicide-data.csv") %>%
  janitor::clean_names() %>% 
  unite(city_state, c(city, state), sep = ",", remove = FALSE) %>% 
  mutate(
    resolved = ifelse(disposition == "Closed by arrest", 1, 0),
    victim_age = as.numeric(victim_age),
    victim_sex = as.factor(victim_sex)) %>% 
  filter(
    !(city_state %in% c("Dallas,TX", "Phoenix,AZ", "Kansas City,MO", "Tulsa,AL")),
    victim_race %in% c("White", "Black")) %>% 
  mutate(
    victim_race = as.factor(victim_race))
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

    ## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion

``` r
head(homicide_data)
```

    ## # A tibble: 6 × 14
    ##   uid        repor…¹ victi…² victi…³ victi…⁴ victi…⁵ victi…⁶ city_…⁷ city  state
    ##   <chr>        <dbl> <chr>   <chr>   <fct>     <dbl> <fct>   <chr>   <chr> <chr>
    ## 1 Alb-000003  2.01e7 SATTER… VIVIANA White        15 Female  Albuqu… Albu… NM   
    ## 2 Alb-000005  2.01e7 MULA    VIVIAN  White        72 Female  Albuqu… Albu… NM   
    ## 3 Alb-000006  2.01e7 BOOK    GERALD… White        91 Female  Albuqu… Albu… NM   
    ## 4 Alb-000009  2.01e7 MARTIN… GUSTAVO White        56 Male    Albuqu… Albu… NM   
    ## 5 Alb-000012  2.01e7 LUJAN   KEVIN   White        NA Male    Albuqu… Albu… NM   
    ## 6 Alb-000016  2.01e7 GRAY    STEFAN… White        43 Female  Albuqu… Albu… NM   
    ## # … with 4 more variables: lat <dbl>, lon <dbl>, disposition <chr>,
    ## #   resolved <dbl>, and abbreviated variable names ¹​reported_date,
    ## #   ²​victim_last, ³​victim_first, ⁴​victim_race, ⁵​victim_age, ⁶​victim_sex,
    ## #   ⁷​city_state

**Note**: In the `homicide_data` df, column `resolved` indicates the
case status. Cases that are closed by arrest (solved cases) are
represented by 1 and cases that are open/no-arrest and closed without
arrest (unsolved cases) are represented by 0.

``` r
balt_log_fit = 
  homicide_data %>% 
  filter(
    city_state == "Baltimore,MD") %>% 
  glm(resolved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())

balt_log_fit_table = broom::tidy(balt_log_fit)

balt_log_fit_table %>% 
  mutate(OR = exp(estimate)) %>%
  select(term, log_OR = estimate, OR, p.value) %>% 
  knitr::kable(digits = 3)
```

| term             | log_OR |    OR | p.value |
|:-----------------|-------:|------:|--------:|
| (Intercept)      |  0.310 | 1.363 |   0.070 |
| victim_age       | -0.007 | 0.993 |   0.043 |
| victim_sexMale   | -0.854 | 0.426 |   0.000 |
| victim_raceWhite |  0.842 | 2.320 |   0.000 |

``` r
male_vic_OR = exp(coef(balt_log_fit))[["victim_sexMale"]]
male_vic_OR_lower = exp(confint(balt_log_fit, "victim_sexMale"))[[1]]
```

    ## Waiting for profiling to be done...

``` r
male_vic_OR_upper = exp(confint(balt_log_fit, "victim_sexMale"))[[2]]
```

    ## Waiting for profiling to be done...

**OR**: 0.4255117

**95% Confidence Interval**: (0.3241908, 0.5575508)

The above odds ratio indicates that controlling all other variables, the
odds of a homicide being solved is \~57.4% lower (between 44.2% and
67.6%) for a male victim compared to a female victim (in the case of
Baltimore, MA between 2007 and 2017).

``` r
hom_all_glm = 
  homicide_data %>% 
  nest(data = -city_state) %>% 
  mutate(
    models = map(.x = data, ~glm(resolved ~ victim_age + victim_sex + victim_race, data = .x, family = binomial())),
    ci = map_df(.x = models, ~confint(object = .x, parm = "victim_sexMale")), 
    results = map(models, broom::tidy)) %>% 
  select(-data, -models) %>% 
  unnest(results) %>% 
  unnest(ci) %>% 
  filter(term == "victim_sexMale") %>% 
  mutate(OR = exp(estimate),
         ci_lower = exp(`2.5 %`),
         ci_upper = exp(`97.5 %`)) %>% 
  select(city_state, term, OR, ci_lower, ci_upper)
```

    ## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

    ## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

    ## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

    ## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

``` r
head(hom_all_glm)
```

    ## # A tibble: 6 × 5
    ##   city_state     term              OR ci_lower ci_upper
    ##   <chr>          <chr>          <dbl>    <dbl>    <dbl>
    ## 1 Albuquerque,NM victim_sexMale 1.77     0.825    3.76 
    ## 2 Atlanta,GA     victim_sexMale 1.00     0.680    1.46 
    ## 3 Baltimore,MD   victim_sexMale 0.426    0.324    0.558
    ## 4 Baton Rouge,LA victim_sexMale 0.381    0.204    0.684
    ## 5 Birmingham,AL  victim_sexMale 0.870    0.571    1.31 
    ## 6 Boston,MA      victim_sexMale 0.674    0.353    1.28

``` r
male_female_odds_plot = 
  hom_all_glm %>%
    ggplot(aes(x = reorder(city_state, OR), y = OR)) +
      geom_point() +
      geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper)) +
      labs(title = "Comparative Odds: Solved Homicides of Male Victims in reference to Female Victims",
           x = "Location (City and State)",
           y = "Comparative Odds",
           caption = "Comparative odds of solved homicides of male victims in reference to female victims with associated 95% confidence intervals between 2007 and 2017 in major US cities.") +
      theme(plot.title = element_text(hjust = 0.5, face = "bold"),
            plot.caption = element_text(hjust = 0.5),
            axis.title = element_text(face = "bold"),
            axis.text.x = element_text(angle = 70, hjust = 1))

male_female_odds_plot
```

<img src="p8105_hw6_td2749_files/figure-gfm/all cities plot-1.png" width="90%" />

**Comment**: Based on the fit model, compared to female homicide victim
cases, male homicide victim cases are less likely to be solved in New
York, NY. More likely in Albuqurque, NM. (ASK ABOUT LIKELIHOOD OF THE
VICTIM BEING MALE/FEMALE IN THE FIRST PLACE).

# Problem 3

``` r
birthweight_data = 
  read_csv("./data/birthweight.csv") %>%
  janitor::clean_names() %>% 
  mutate(
    babysex = as.factor(babysex),
    frace = as.factor(frace),
    malform = as.factor(malform),
    mrace = as.factor(mrace))
```

    ## Rows: 4342 Columns: 20
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (20): babysex, bhead, blength, bwt, delwt, fincome, frace, gaweeks, malf...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

- There are no missing values in this dataset (0).

??? Describe your modeling process ???

`mrace`: (1 = White, 2 = Black, 3 = Asian, 4 = Puerto Rican, 8 = Other)
`momage`: Ranging from 12 - 44.

``` r
bwt_momage_mrace_scatter = 
  birthweight_data %>% 
    ggplot(aes(x = momage, y = bwt, color = mrace)) +
    geom_point(aes(alpha = 0.3))
```

``` r
my_model = 
  birthweight_data %>% 
  lm(bwt ~ momage + mrace, data = .)

summary(my_model)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ momage + mrace, data = .)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -2422.32  -269.79    17.96   313.78  1561.94 
    ## 
    ## Coefficients:
    ##             Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) 3160.133     45.573  69.342  < 2e-16 ***
    ## momage         4.939      2.056   2.403   0.0163 *  
    ## mrace2      -302.983     16.375 -18.503  < 2e-16 ***
    ## mrace3      -145.221     75.648  -1.920   0.0550 .  
    ## mrace4      -202.724     33.258  -6.095 1.19e-09 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 488.5 on 4337 degrees of freedom
    ## Multiple R-squared:  0.09095,    Adjusted R-squared:  0.09011 
    ## F-statistic: 108.5 on 4 and 4337 DF,  p-value: < 2.2e-16

``` r
birthweight_data %>% 
  select(momage, mrace, bwt) %>% 
  modelr::add_residuals(., my_model) %>% 
  modelr::add_predictions(., my_model) %>% 
    ggplot(aes(x = pred, y = resid)) +
    geom_point() +
    geom_hline(yintercept = 0)
```

<img src="p8105_hw6_td2749_files/figure-gfm/residuals vs. fitted values plot-1.png" width="90%" />

``` r
# One using length at birth and gestational age as predictors (main effects only)
blength_gaweeks_fit = 
  birthweight_data %>% 
  lm(bwt ~ blength + gaweeks, data = .)

summary(blength_gaweeks_fit)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ blength + gaweeks, data = .)
    ## 
    ## Residuals:
    ##     Min      1Q  Median      3Q     Max 
    ## -1709.6  -215.4   -11.4   208.2  4188.8 
    ## 
    ## Coefficients:
    ##              Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -4347.667     97.958  -44.38   <2e-16 ***
    ## blength       128.556      1.990   64.60   <2e-16 ***
    ## gaweeks        27.047      1.718   15.74   <2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 333.2 on 4339 degrees of freedom
    ## Multiple R-squared:  0.5769, Adjusted R-squared:  0.5767 
    ## F-statistic:  2958 on 2 and 4339 DF,  p-value: < 2.2e-16

``` r
# One using head circumference, length, sex, and all interactions (including the three-way interaction) between these
bhead_blength_babysex_fit = 
  birthweight_data %>% 
  lm(bwt ~ bhead + blength + babysex + bhead*blength*babysex, data = .)

summary(bhead_blength_babysex_fit)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ bhead + blength + babysex + bhead * blength * 
    ##     babysex, data = .)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1132.99  -190.42   -10.33   178.63  2617.96 
    ## 
    ## Coefficients:
    ##                          Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)            -7176.8170  1264.8397  -5.674 1.49e-08 ***
    ## bhead                    181.7956    38.0542   4.777 1.84e-06 ***
    ## blength                  102.1269    26.2118   3.896 9.92e-05 ***
    ## babysex2                6374.8684  1677.7669   3.800 0.000147 ***
    ## bhead:blength             -0.5536     0.7802  -0.710 0.478012    
    ## bhead:babysex2          -198.3932    51.0917  -3.883 0.000105 ***
    ## blength:babysex2        -123.7729    35.1185  -3.524 0.000429 ***
    ## bhead:blength:babysex2     3.8781     1.0566   3.670 0.000245 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 287.7 on 4334 degrees of freedom
    ## Multiple R-squared:  0.6849, Adjusted R-squared:  0.6844 
    ## F-statistic:  1346 on 7 and 4334 DF,  p-value: < 2.2e-16

Make this comparison in terms of the cross-validated prediction error;
use crossv_mc and functions in purrr as appropriate.
