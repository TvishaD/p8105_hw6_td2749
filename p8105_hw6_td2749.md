p8105_hw6_td2749
================
Tvisha R. Devavarapu
2022-11-22

``` r
library(tidyverse)
library(ggplot2)

knitr::opts_chunk$set(
  fig.width = 10,
  fig.asp = .6,
  out.width = "90%")
```

# Problem 2

``` r
homicide_data = 
  read_csv("./data/homicide-data.csv") %>%
  janitor::clean_names() %>% 
  unite(city_state, c(city, state), sep = ",", remove = FALSE) %>% 
  mutate(
    resolved = ifelse(disposition == "Closed by arrest", 1, 0),
    victim_age = as.numeric(victim_age),
    victim_sex = as.factor(victim_sex)) %>% 
  filter(
    !(city_state %in% c("Dallas,TX", "Phoenix,AZ", "Kansas City,MO", "Tulsa,AL")),
    victim_race %in% c("White", "Black")) %>% 
  mutate(
    victim_race = as.factor(victim_race))
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

    ## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion

``` r
head(homicide_data)
```

    ## # A tibble: 6 × 14
    ##   uid        repor…¹ victi…² victi…³ victi…⁴ victi…⁵ victi…⁶ city_…⁷ city  state
    ##   <chr>        <dbl> <chr>   <chr>   <fct>     <dbl> <fct>   <chr>   <chr> <chr>
    ## 1 Alb-000003  2.01e7 SATTER… VIVIANA White        15 Female  Albuqu… Albu… NM   
    ## 2 Alb-000005  2.01e7 MULA    VIVIAN  White        72 Female  Albuqu… Albu… NM   
    ## 3 Alb-000006  2.01e7 BOOK    GERALD… White        91 Female  Albuqu… Albu… NM   
    ## 4 Alb-000009  2.01e7 MARTIN… GUSTAVO White        56 Male    Albuqu… Albu… NM   
    ## 5 Alb-000012  2.01e7 LUJAN   KEVIN   White        NA Male    Albuqu… Albu… NM   
    ## 6 Alb-000016  2.01e7 GRAY    STEFAN… White        43 Female  Albuqu… Albu… NM   
    ## # … with 4 more variables: lat <dbl>, lon <dbl>, disposition <chr>,
    ## #   resolved <dbl>, and abbreviated variable names ¹​reported_date,
    ## #   ²​victim_last, ³​victim_first, ⁴​victim_race, ⁵​victim_age, ⁶​victim_sex,
    ## #   ⁷​city_state

**Note**: In the `homicide_data` df, column `resolved` indicates the
case status. Cases that are closed by arrest (solved cases) are
represented by 1 and cases that are open/no-arrest and closed without
arrest (unsolved cases) are represented by 0.

``` r
balt_log_fit = 
  homicide_data %>% 
  filter(
    city_state == "Baltimore,MD") %>% 
  glm(resolved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())

balt_log_fit_table = broom::tidy(balt_log_fit)

balt_log_fit_table %>% 
  mutate(OR = exp(estimate)) %>%
  select(term, log_OR = estimate, OR, p.value) %>% 
  knitr::kable(digits = 3)
```

| term             | log_OR |    OR | p.value |
|:-----------------|-------:|------:|--------:|
| (Intercept)      |  0.310 | 1.363 |   0.070 |
| victim_age       | -0.007 | 0.993 |   0.043 |
| victim_sexMale   | -0.854 | 0.426 |   0.000 |
| victim_raceWhite |  0.842 | 2.320 |   0.000 |

``` r
male_vic_OR = exp(coef(balt_log_fit))[["victim_sexMale"]]
male_vic_OR_lower = exp(confint(balt_log_fit, "victim_sexMale"))[[1]]
```

    ## Waiting for profiling to be done...

``` r
male_vic_OR_upper = exp(confint(balt_log_fit, "victim_sexMale"))[[2]]
```

    ## Waiting for profiling to be done...

**OR**: 0.4255117

**95% Confidence Interval**: (0.3241908, 0.5575508)

The above odds ratio indicates that controlling all other variables, the
odds of a homicide being solved is \~57.4% lower (between 44.2% and
67.6%) for a male victim compared to a female victim (in the case of
Baltimore, MA between 2007 and 2017).

``` r
hom_all_glm = 
  homicide_data %>% 
  nest(data = -city_state) %>% 
  mutate(
    models = map(.x = data, ~glm(resolved ~ victim_age + victim_sex + victim_race, data = .x, family = binomial())),
    ci = map_df(.x = models, ~confint(object = .x, parm = "victim_sexMale")), 
    results = map(models, broom::tidy)) %>% 
  select(-data, -models) %>% 
  unnest(results) %>% 
  unnest(ci) %>% 
  filter(term == "victim_sexMale") %>% 
  mutate(OR = exp(estimate),
         ci_lower = exp(`2.5 %`),
         ci_upper = exp(`97.5 %`)) %>% 
  select(city_state, term, OR, ci_lower, ci_upper)
```

    ## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

    ## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

    ## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

    ## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

``` r
head(hom_all_glm)
```

    ## # A tibble: 6 × 5
    ##   city_state     term              OR ci_lower ci_upper
    ##   <chr>          <chr>          <dbl>    <dbl>    <dbl>
    ## 1 Albuquerque,NM victim_sexMale 1.77     0.825    3.76 
    ## 2 Atlanta,GA     victim_sexMale 1.00     0.680    1.46 
    ## 3 Baltimore,MD   victim_sexMale 0.426    0.324    0.558
    ## 4 Baton Rouge,LA victim_sexMale 0.381    0.204    0.684
    ## 5 Birmingham,AL  victim_sexMale 0.870    0.571    1.31 
    ## 6 Boston,MA      victim_sexMale 0.674    0.353    1.28
